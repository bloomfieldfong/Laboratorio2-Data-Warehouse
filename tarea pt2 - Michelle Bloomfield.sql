-- PARTE 3
CREATE DATABASE RecursosHumanos;
USE RecursosHumanos;
CREATE TABLE DEPARTAMENTO (
ID INT NOT NULL,
NOMBRE VARCHAR(50),
LOCALIDAD VARCHAR(50),
CONSTRAINT DEPARTAMENTOS_PK
PRIMARY KEY (ID)
);
CREATE TABLE RANGO_SUELDO (
GRADO INT PRIMARY KEY ,
SUELDO_MIN DECIMAL(9,2),
SUELDO_MAX DECIMAL(9,2)
);
CREATE TABLE EMPLEADO (
ID INT NOT NULL,
NOMBRE VARCHAR(30),
APELLIDOS VARCHAR(60),
TELEFONO VARCHAR(25),
EMAIL VARCHAR(50),
CARGO VARCHAR(20),
JEFE_ID INT,
FECHA_ALTA DATE,
SUELDO DECIMAL(9,2),
COMISION DECIMAL(9,2),
DEPARTAMENTO_ID INT NOT NULL,
CONSTRAINT EMPLEADOS_PK
PRIMARY KEY (ID),
CONSTRAINT DEPARTAMENTO_ID_FK
FOREIGN KEY (DEPARTAMENTO_ID) REFERENCES DEPARTAMENTO(ID),
CONSTRAINT EMAIL_CHK
CHECK ( EMAIL REGEXP '^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-
.]+$'),
CONSTRAINT TELEFONO_CHK
CHECK ( TELEFONO REGEXP '^[+]*[(]{0,1}[0-9]{1,4}[)]{0,1}[-
[[:space:]]\./0-9]*$' )
);

INSERT INTO EMPLEADO (ID, NOMBRE, APELLIDOS, EMAIL, TELEFONO, CARGO, JEFE_ID,
FECHA_ALTA, SUELDO, COMISION, DEPARTAMENTO_ID)
VALUES (6, 'INES', 'FERNANDEZ SANCHEZ', 'fsanchez@gmail.com','+50255552612',
'PRESIDENTE', NULL, '1991-11-17', 5000, NULL, 1);


INSERT INTO EMPLEADO (ID, NOMBRE, APELLIDOS, TELEFONO, EMAIL, CARGO, JEFE_ID,
FECHA_ALTA, SUELDO, COMISION, DEPARTAMENTO_ID)
VALUES (4, 'ESTHER', 'PEÑA MATA', '+34937377761','epena@gmail.com','DIRECTOR',
6,str_to_date('01/05/1991', '%d/%m/%Y'), 2850, NULL, 3);

INSERT INTO EMPLEADO (ID, NOMBRE, APELLIDOS, TELEFONO, EMAIL, CARGO, JEFE_ID,
FECHA_ALTA, SUELDO, COMISION, DEPARTAMENTO_ID)
VALUES (5, 'DANIEL', 'LOPEZ LEON', '+34937377780','dlopez@gmail.com','DIRECTOR',
6,str_to_date('09/06/1991', '%d/%m/%Y'), 2450, NULL, 1);
INSERT INTO EMPLEADO (ID, NOMBRE, APELLIDOS, TELEFONO, EMAIL, CARGO, JEFE_ID,
FECHA_ALTA, SUELDO, COMISION, DEPARTAMENTO_ID)
VALUES (1, 'CARLOS', 'ALONSO GARCIA',
'34937377770','carlos.alonso@gmail.com','COMERCIAL', 4,
str_to_date('20/02/1991', '%d/%m/%Y'), 1600, 30, 3);
INSERT INTO EMPLEADO (ID, NOMBRE, APELLIDOS, TELEFONO, EMAIL, CARGO, JEFE_ID,
FECHA_ALTA, SUELDO, COMISION, DEPARTAMENTO_ID)
VALUES (2, 'ANDRES', 'GOMEZ SEGUNDO', '+(34) 937-376-525',
'andres.gomez@gmail.com', 'COMERCIAL', 4, str_to_date('22/02/1991', '%d/%m/%Y'),
1250, 50, 3);
INSERT INTO EMPLEADO (ID, NOMBRE, APELLIDOS, TELEFONO, EMAIL, CARGO, JEFE_ID,
FECHA_ALTA, SUELDO, COMISION, DEPARTAMENTO_ID)
VALUES (3, 'ANA', 'HERRANZ CIFUENTES', '+34937376523','herranz.ana@gmail.com',
'COMERCIAL', 4,str_to_date('28/09/1991', '%d/%m/%Y'), 1250, 140, 3);
INSERT INTO EMPLEADO (ID, NOMBRE, APELLIDOS, TELEFONO, EMAIL, CARGO, JEFE_ID,
FECHA_ALTA, SUELDO, COMISION, DEPARTAMENTO_ID)
VALUES (7, 'TOMAS', 'CALLEJA ARCAZ','+34937376541','tomas.calleja@gmail.com',
'COMERCIAL', 4, str_to_date( '08/09/1991', '%d/%m/%Y'), 1500, 0, 3);
COMMIT ;
INSERT INTO DEPARTAMENTO (ID, NOMBRE, LOCALIDAD)
VALUES (1, 'INFORMATICA', 'BILBAO');
INSERT INTO DEPARTAMENTO (ID, NOMBRE, LOCALIDAD)
VALUES (2, 'INVESTIGACION', 'MADRID');
INSERT INTO DEPARTAMENTO (ID, NOMBRE, LOCALIDAD)
VALUES (3, 'VENTAS', 'BARCELONA');
INSERT INTO DEPARTAMENTO (ID, NOMBRE, LOCALIDAD)
VALUES (4, 'PRODUCCION', 'VALENCIA');
COMMIT ;
INSERT INTO RANGO_SUELDO (GRADO, SUELDO_MIN, SUELDO_MAX)
VALUES (1, 700, 1200);
INSERT INTO RANGO_SUELDO (GRADO, SUELDO_MIN, SUELDO_MAX)
VALUES (2, 1201, 1400);
INSERT INTO RANGO_SUELDO (GRADO, SUELDO_MIN, SUELDO_MAX)
VALUES (3, 1401, 2000);
INSERT INTO RANGO_SUELDO (GRADO, SUELDO_MIN, SUELDO_MAX)
VALUES (4, 2001, 3000);
INSERT INTO RANGO_SUELDO (GRADO, SUELDO_MIN, SUELDO_MAX)
VALUES (5, 3001, 9999);
COMMIT ;
INSERT INTO EMPLEADO (ID, NOMBRE, APELLIDOS, EMAIL, TELEFONO, CARGO, JEFE_ID,
FECHA_ALTA, SUELDO, COMISION, DEPARTAMENTO_ID)
VALUES (6, 'INES', 'FERNANDEZ SANCHEZ', 'fsanchez@gmail.com','+50255552612',
'PRESIDENTE', NULL, '1991-11-17', 5000, NULL, 1);
INSERT INTO EMPLEADO (ID, NOMBRE, APELLIDOS, TELEFONO, EMAIL, CARGO, JEFE_ID,
FECHA_ALTA, SUELDO, COMISION, DEPARTAMENTO_ID)
VALUES (4, 'ESTHER', 'PEÑA MATA', '+34937377761','epena@gmail.com','DIRECTOR',
6,str_to_date('01/05/1991', '%d/%m/%Y'), 28G50, NULL, 3);
INSERT INTO EMPLEADO (ID, NOMBRE, APELLIDOS, TELEFONO, EMAIL, CARGO, JEFE_ID,
FECHA_ALTA, SUELDO, COMISION, DEPARTAMENTO_ID)
VALUES (5, 'DANIEL', 'LOPEZ LEON', '+34937377780','dlopez@gmail.com','DIRECTOR',
6,str_to_date('09/06/1991', '%d/%m/%Y'), 2450, NULL, 1);
INSERT INTO EMPLEADO (ID, NOMBRE, APELLIDOS, TELEFONO, EMAIL, CARGO, JEFE_ID,
FECHA_ALTA, SUELDO, COMISION, DEPARTAMENTO_ID)
VALUES (1, 'CARLOS', 'ALONSO GARCIA',
'34937377770','carlos.alonso@gmail.com','COMERCIAL', 4,
str_to_date('20/02/1991', '%d/%m/%Y'), 1600, 30, 3);
INSERT INTO EMPLEADO (ID, NOMBRE, APELLIDOS, TELEFONO, EMAIL, CARGO, JEFE_ID,
FECHA_ALTA, SUELDO, COMISION, DEPARTAMENTO_ID)
VALUES (2, 'ANDRES', 'GOMEZ SEGUNDO', '+(34) 937-376-525',
'andres.gomez@gmail.com', 'COMERCIAL', 4, str_to_date('22/02/1991', '%d/%m/%Y'),
1250, 50, 3);
INSERT INTO EMPLEADO (ID, NOMBRE, APELLIDOS, TELEFONO, EMAIL, CARGO, JEFE_ID,
FECHA_ALTA, SUELDO, COMISION, DEPARTAMENTO_ID)
VALUES (3, 'ANA', 'HERRANZ CIFUENTES', '+34937376523','herranz.ana@gmail.com',
'COMERCIAL', 4,str_to_date('28/09/1991', '%d/%m/%Y'), 1250, 140, 3);
INSERT INTO EMPLEADO (ID, NOMBRE, APELLIDOS, TELEFONO, EMAIL, CARGO, JEFE_ID,
FECHA_ALTA, SUELDO, COMISION, DEPARTAMENTO_ID)
VALUES (7, 'TOMAS', 'CALLEJA ARCAZ','+34937376541','tomas.calleja@gmail.com',
'COMERCIAL', 4, str_to_date( '08/09/1991', '%d/%m/%Y'), 1500, 0, 3);
COMMIT ;

 -- 1 
/* 
Generar una tabla de separación de empleado en donde tenga todos sus datos como por ejemplo: 
id, nombre, apellidos, teléfono, email, carg y fecha_alta y otra tabla que tenga como llave 
su id en donde tenga los datos de su sueldo, departamento, comision (sus datos empresariales).

*/

 -- 2
/*
Primero no registra ya que en la tabla de departamento aún no existen datos. Para corregir 
esto se debe de ingresar los datos primero de departamento para ingresar los datos de empleado. 

Luego individualmente: 

En este registro se tenía error ya que el correo y el número de teléfono no tiene validación
de expresión regular, no acepta signos y el número no acepta letras. Se arregla quitando el ! y la “a”.

INSERT INTO EMPLEADO (ID, NOMBRE, APELLIDOS, EMAIL, TELEFONO, CARGO, JEFE_ID,
FECHA_ALTA, SUELDO, COMISION, DEPARTAMENTO_ID)
VALUES (6, 'INES', 'FERNANDEZ SANCHEZ', 'fsanchez@gmail.com','+50255552612',
'PRESIDENTE', NULL, '1991-11-17', 5000, NULL, 1);

*/

 -- 3
select apellidos from EMPLEADO;

 -- 4
select distinct(apellidos) from EMPLEADO;

 -- 5
select apellidos from EMPREDO WHERE APELLIDOS LIKE  '%LOPEZ%';

 -- 6
Select apellidos from EMPLEADO where apellidos LIKE '%LOPEZ%' OR apellidos LIKE "%PEÑA%";

-- 7
select EMPLEADO.NOMBRE, EMPLEADO.APELLIDOS, EMPLEADO.TELEFONO, EMPLEADO.EMAIL, EMPLEADO.CARGO
from EMPLEADO 
JOIN DEPARTAMENTO ON DEPARTAMENTO.ID = EMPLEADO.DEPARTAMENTO_ID
WHERE DEPARTAMENTO.NOMBRE = "INFORMATICA";

-- 8
SELECT NOMBRE
FROM EMPLEADO
WHERE NOMBRE LIKE "I%";

-- 9
SELECT NOMBRE, COUNT(NOMBRE) FROM DEPARTAMENTO GROUP BY NOMBRE;

-- 10
SELECT DISTINCT(CARGO) FROM EMPLEADO;

-- 11
SELECT concat(APELLIDOS," " ,NOMBRE,": ES " , CARGO) as Cargos FROM EMPLEADO;

-- 12 
SELECT NOMBRE, APELLIDOS, SUELDO, COMISION FROM EMPLEADO WHERE COMISION > 150;

-- 13 
SELECT * FROM EMPLEADO WHERE CARGO != "COMERCIAL" AND NOMBRE LIKE "%N%";

-- 14
SELECT NOMBRE, SUELDO, COMISION FROM EMPLEADO ORDER BY SUELDO DESC;

-- 15
SELECT NOMBRE, APELLIDOS FROM EMPLEADO ORDER BY APELLIDOS ASC, NOMBRE ASC;

-- 16

SELECT NOMBRE, SUELDO, FECHA_ALTA FROM EMPLEADO WHERE COMISION IS NULL GROUP BY FECHA_ALTA;

-- 17 

-- 18
SELECT concat(NOMBRE, " ",APELLIDOS, " EMPEZO A TRABAJAR EL ", FECHA_ALTA) AS FECHA_ENTRADA FROM EMPLEADO;

-- 19 
SELECT NOMBRE, COMISION, SUELDO,
CASE WHEN COMISION < 50 THEN SUELDO * 1.25 ELSE SUELDO * 1.12 END AS SUELDO_INCREMENTADO
FROM EMPLEADO
WHERE CARGO = 'COMERCIAL';

-- 20
SELECT EMPLEADO.NOMBRE, DEPARTAMENTO.LOCALIDAD, EMPLEADO.SUELDO 
FROM EMPLEADO 
JOIN DEPARTAMENTO ON EMPLEADO.DEPARTAMENTO_ID = DEPARTAMENTO.ID 
WHERE JEFE_ID = 3 OR JEFE_ID = 2;

-- 21
SELECT DEPARTAMENTO.NOMBRE, COUNT(DEPARTAMENTO.NOMBRE) 
FROM EMPLEADO
JOIN DEPARTAMENTO ON EMPLEADO.DEPARTAMENTO_ID = DEPARTAMENTO.ID 
WHERE SUELDO*12 >= 18000.00 OR COMISION*12 >= 18000.00
group by DEPARTAMENTO.NOMBRE;

-- 22
SELECT COUNT(DEPARTAMENTO.NOMBRE)
FROM EMPLEADO 
JOIN DEPARTAMENTO ON EMPLEADO.DEPARTAMENTO_ID = DEPARTAMENTO.ID 
WHERE DEPARTAMENTO.NOMBRE = "VENTAS";

-- 23 

SELECT AVG(COMISION)
FROM EMPLEADO
WHERE CARGO != 'PRESIDENTE';

-- 24 
SELECT EMPLEADO.NOMBRE, RANGO_SUELDO.SUELDO_MAX
FROM RANGO_SUELDO 
JOIN EMPLEADO ON RANGO_SUELDO.GRADO = EMPLEADO.JEFE_ID 
WHERE SUELDO_MIN > 780; 


-- 25 
SELECT LOCALIDAD, COUNT(LOCALIDAD) FROM DEPARTAMENTO JOIN EMPLEADO ON EMPLEADO.DEPARTAMENTO_ID = DEPARTAMENTO.ID WHERE LOCALIDAD = "BILBAO";


-- 26
SELECT NOMBRE, FECHA_ALTA FROM EMPLEADO WHERE DEPARTAMENTO_ID = (SELECT DEPARTAMENTO_ID FROM EMPLEADO WHERE NOMBRE = "ESTHER");



















